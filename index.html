<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç›´æ’­è½‰ç›¤ç«¯</title>
    <script src="https://js.pusher.com/8.4.0/pusher.min.js"></script>
    <style>
        body { background: transparent; color: white; font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #wheel-container { position: relative; width: 600px; height: 600px; }
        canvas { width: 100%; height: 100%; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        #arrow { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-top: 50px solid #ff4757; z-index: 10; filter: drop-shadow(0 0 5px black); }
        #result-display { margin-top: 30px; font-size: 60px; font-weight: bold; text-shadow: 2px 2px 5px black; text-align: center; min-height: 80px; }
    </style>
</head>
<body>
    <div id="wheel-container"><div id="arrow"></div><canvas id="wheel" width="600" height="600"></canvas></div>
    <div id="result-display">ç­‰å¾…æŒ‡ä»¤ä¸­...</div>

    <script>
        // --- Pusher è¨­å®š (æ ¹æ“šä½ å‰›æ‰æä¾›çš„ç¯„ä¾‹ä¿®æ”¹) ---
        var pusher = new Pusher('fc2f1ab8fb364bb25513', {
            cluster: 'ap3'
        });

        // è¨‚é–±é »é“èˆ‡ç¶å®šäº‹ä»¶
        var channel = pusher.subscribe('my-channel');
        channel.bind('my-event', function(data) {
            console.log("æ”¶åˆ°é›²ç«¯æŒ‡ä»¤:", data);
            if (!isSpinning) {
                startSpin();
            }
        });

        // --- è½‰ç›¤æ ¸å¿ƒé‚è¼¯ ---
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const resDiv = document.getElementById('result-display');
        const options = ["åŠ é‡ 10%", "åŠ é‡ 20%", "å¤§é©šå–œ", "åŠ é‡ 50%", "éŠ˜è¬æƒ é¡§", "è¶…ç´šå¤§çŽ"];
        let isSpinning = false;
        let currentRotation = 0;

        function draw() {
            const arc = (2 * Math.PI) / 6;
            options.forEach((text, i) => {
                ctx.save();
                ctx.translate(300, 300);
                ctx.rotate(i * arc - Math.PI / 2);
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.arc(0, 0, 280, 0, arc);
                ctx.fillStyle = i % 2 === 0 ? '#1e90ff' : '#3742fa';
                ctx.fill(); ctx.strokeStyle = "white"; ctx.lineWidth = 5; ctx.stroke();
                ctx.rotate(arc / 2); ctx.fillStyle = "white"; ctx.font = "bold 44px Microsoft JhengHei";
                ctx.textAlign = "right"; ctx.fillText(text, 260, 15); ctx.restore();
            });
        }
        draw();

        function startSpin() {
            isSpinning = true;
            resDiv.innerText = "æ­£åœ¨æŠ½çŽ...";
            const targetIdx = Math.floor(Math.random() * options.length);
            const segmentAngle = 360 / options.length;
            const stopAngle = 360 - (targetIdx * segmentAngle) - (segmentAngle / 2);
            currentRotation += (10 * 360) + (stopAngle - (currentRotation % 360));
            canvas.style.transform = `rotate(${currentRotation}deg)`;
            
            setTimeout(() => {
                const result = options[targetIdx];
                resDiv.innerText = "ðŸŽŠ " + result + " ðŸŽŠ";
                setTimeout(() => { isSpinning = false; }, 3000);
            }, 5200);
        }
    </script>
</body>
</html>
